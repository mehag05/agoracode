"use strict";(self.webpackChunkagora_frontend=self.webpackChunkagora_frontend||[]).push([[281],{9281:(e,r,t)=>{t.r(r),t.d(r,{default:()=>u});var a=t(9643),s=t(3231),o=t(8312),i=t(9204),n=t(891),l=t(3696),d=t.n(l),c=t(6507);const p=()=>{const[e,r]=(0,a.useState)({name:"",description:"",price:"",category:"clothing-item",size:"",ticketLink:"",images:[]}),[t,o]=(0,a.useState)(null),l=e=>{const{name:t,value:a}=e.target;if("price"===t){const e=parseFloat(a);isNaN(e)&&""!==a||r((e=>({...e,[t]:a})))}else r((e=>({...e,[t]:a})))},{getRootProps:p,getInputProps:m}=(0,n.VB)({onDrop:async e=>{const t=["image/jpeg","image/png","image/jpg","image/gif","image/webp","image/svg+xml"],a=[];for(const r of e){if(!t.includes(r.type))return void window.alert("You must have uploaded an unsupported image type. HEIC files make our site slow :(. Try JPG, JPEG, PNG, or even GIF! Happy selling!");a.push(r)}r((e=>({...e,images:[...e.images,...a]})))},accept:{"image/jpeg":[".jpeg"],"image/png":[".png"],"image/jpg":[".jpg"],"image/gif":[".gif"],"image/webp":[".webp"],"image/svg+xml":[".svg"]}});return(0,c.jsxs)("div",{className:"p-4",children:[(0,c.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Upload Product"}),t&&(0,c.jsx)("div",{className:"text-red-500",children:t}),(0,c.jsxs)("form",{onSubmit:async r=>{if(r.preventDefault(),!e.name||!e.description||e.price<=0||!e.category)return void window.alert("please fill in all fields correctly.");if("clothing-item"===e.category&&!e.size)return void window.alert("size is required for clothing items.");if("event-ticket"===e.category&&!e.ticketLink)return void window.alert("ticket link is required for event tickets.");if(isNaN(e.price))return void window.alert("price must be a valid number.");o(null);const a=new FormData;a.append("name",e.name),a.append("description",e.description),a.append("price",e.price.toString()),a.append("category",e.category),a.append("size",e.size),a.append("ticketLink",e.ticketLink),e.images.forEach((e=>{a.append("images",e)})),console.log("Submitting product:",{name:e.name,description:e.description,price:e.price,category:e.category,size:e.size,ticketLink:e.ticketLink,images:e.images.map((e=>e.name))});const i=await d().getAccessToken();try{const e=await s.A.post("http://localhost:3001/api/products",a,{headers:{Authorization:`Bearer ${i}`}});console.log("Upload response:",e),201===e.status?window.location.reload():console.error("Unexpected response:",e)}catch(t){var n,l;if(console.error("Error uploading product:",t),s.A.isAxiosError(t))console.error("Response data:",null===(n=t.response)||void 0===n?void 0:n.data),console.error("Response status:",null===(l=t.response)||void 0===l?void 0:l.status)}},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Product Name"}),(0,c.jsx)("input",{type:"text",name:"name",value:e.name,onChange:l,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md p-2"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Description"}),(0,c.jsx)("textarea",{name:"description",value:e.description,onChange:l,placeholder:"How would you sell this to a recruiter at a career fair? ;)",className:"mt-1 block w-full border border-gray-300 rounded-md p-2"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Price"}),(0,c.jsx)("input",{type:"number",name:"price",value:e.price,onChange:l,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md p-2"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Category"}),(0,c.jsxs)("select",{name:"category",value:e.category,onChange:l,className:"mt-1 block w-full border border-gray-300 rounded-md p-2",children:[(0,c.jsx)("option",{value:"clothing-item",children:"Clothing Item"}),(0,c.jsx)("option",{value:"accessories",children:"Accessories"}),(0,c.jsx)("option",{value:"dorm-item",children:"Dorm Item"}),(0,c.jsx)("option",{value:"shoes",children:"Shoes"}),(0,c.jsx)("option",{value:"event-ticket",children:"Event Ticket"}),(0,c.jsx)("option",{value:"other",children:"Other"}),(0,c.jsx)("option",{value:"lease",children:"Lease"})]})]}),"clothing-item"===e.category&&(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Size"}),(0,c.jsx)("input",{type:"text",name:"size",value:e.size,onChange:l,className:"mt-1 block w-full border border-gray-300 rounded-md p-2",required:!0})]}),"event-ticket"===e.category&&(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium",children:"Ticket Link"}),(0,c.jsx)("input",{type:"text",name:"ticketLink",value:e.ticketLink,onChange:l,className:"mt-1 block w-full border border-gray-300 rounded-md p-2",required:!0})]}),(0,c.jsxs)("div",{...p(),className:"border border-dashed border-gray-300 rounded-md p-4 cursor-pointer",children:[(0,c.jsx)("input",{...m()}),(0,c.jsx)("p",{children:"Drag & drop some files here, or click to select files"})]}),(0,c.jsx)("div",{className:"mt-2",children:e.images.map(((e,t)=>(0,c.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,c.jsx)("img",{src:URL.createObjectURL(e),alt:`Uploaded Image ${t+1}`,className:"w-16 h-16 object-cover rounded-md"}),(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{r((r=>({...r,images:r.images.filter(((r,t)=>t!==e))})))})(t),className:"text-red-500",children:"X"})]},t)))}),(0,c.jsx)(i.$,{variant:"bigpurple",type:"submit",children:"Upload product"})]})]})};function m(){const[e,r]=(0,a.useState)(!1),[t,n]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[p,m]=(0,a.useState)(),{user:u,loading:h,error:g}=(0,o.Q)();return(0,c.jsx)("div",{className:"container",children:(0,c.jsxs)("div",{className:"header",children:[!p&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("h2",{children:"Want to start selling on Agora?"})}),p&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h2",{children:"Add your information to start accepting money and selling your products"}),(0,c.jsx)("h2",{children:"This should only take around 5 minutes."})]}),!e&&!p&&(0,c.jsx)(i.$,{variant:"bigpurple",onClick:async()=>{r(!0),d(!1);try{const e=await s.A.post("http://localhost:3001/account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:u._id})});if(200!==e.status)throw new Error(e.data.error||"Failed to create account");const{account:r}=e.data;r&&(m(r),await s.A.post("http://localhost:3001/api/update_user_stripe_id",{userId:u._id,stripeId:r}))}catch(l){console.error("Error creating account:",l),d(!0)}finally{r(!1)}},children:"Enter your details to start receiving payments."}),p&&!t&&(0,c.jsx)(i.$,{variant:"bigpurple",onClick:async()=>{n(!0),d(!1),s.A.post("http://localhost:3001/account_link",{account:p}).then((e=>{n(!1);const{url:r,error:t}=e.data;r&&(window.location.href=r),t&&d(!0)})).catch((e=>{console.error("Error creating account link:",e),d(!0)}))},children:"Add information"}),l&&(0,c.jsx)("p",{className:"text-sm text-red-500",children:"Something went wrong!"}),(p||e||t)&&(0,c.jsxs)("div",{className:"dev-callout",children:[e&&(0,c.jsx)("p",{className:"text-sm",children:"Creating a connected account..."}),t&&(0,c.jsx)("p",{className:"text-sm",children:"Creating a new Account Link..."})]})]})})}const u=()=>{const[e,r]=(0,a.useState)(!1),[t,n]=(0,a.useState)([]),{user:l,loading:u,error:h}=(0,o.Q)(),g=null===l||void 0===l?void 0:l.supertokens_id,[x,b]=(0,a.useState)(null);(0,a.useEffect)((()=>{!u&&l&&(async()=>{if(g)try{const e=await s.A.get(`http://localhost:3001/api/productslisted/${g}`);n(e.data)}catch(x){b(x.response?x.response.data:"Error fetching products"),console.error("Error fetching products:",x)}else b("User ID is not available.")})()}),[u,l]);const y=(0,a.useMemo)((()=>t.reduce(((e,r)=>(e[r._id]="sold"===r.approvedForSale,e)),{})),[t]);return(0,c.jsxs)("div",{className:"p-8",children:[l&&null==l.stripe_account_id&&(0,c.jsx)("div",{className:"mt-8",children:(0,c.jsx)(m,{})}),(0,c.jsxs)("div",{className:"container mx-auto p-8 bg-gray-50 rounded-lg shadow-lg",children:[(0,c.jsx)("h1",{className:"text-4xl font-extrabold text-gray-800 mb-6",children:"Seller Dashboard"}),(0,c.jsx)("div",{className:"mb-6",children:l&&l.stripe_account_id&&(0,c.jsx)(i.$,{onClick:()=>{r((e=>!e))},variant:"bigpurple",className:"transition duration-300 ease-in-out transform hover:scale-105 focus:ring-4 focus:ring-purple-300",children:e?"Cancel":"Add product"})}),(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4",role:"alert",children:[(0,c.jsx)("p",{className:"font-bold",children:"Heads up!"}),(0,c.jsx)("p",{children:"Stripe takes a fee of 3% (plus 30 cents) that will come out of your price, so it is suggested that you price your items accordingly. Happy Selling!"})]})}),e&&l&&l.stripe_account_id&&(0,c.jsx)("div",{className:"mb-8",children:(0,c.jsx)(p,{})}),(0,c.jsx)("h2",{className:"text-2xl font-semibold text-gray-700 mb-4",children:"My Products"}),(0,c.jsx)("div",{className:"overflow-x-auto rounded-lg shadow-inner",children:(0,c.jsxs)("table",{className:"min-w-full table-auto bg-white rounded-lg",children:[(0,c.jsx)("thead",{className:"bg-purple-100 text-gray-700",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"text-left px-6 py-4 border-b border-gray-300",children:"Product Name"}),(0,c.jsx)("th",{className:"text-left px-6 py-4 border-b border-gray-300",children:"Status"}),(0,c.jsx)("th",{className:"text-left px-6 py-4 border-b border-gray-300"}),(0,c.jsx)("th",{className:"text-left px-6 py-4 border-b border-gray-300",children:"Edit"}),(0,c.jsx)("th",{className:"text-left px-6 py-4 border-b border-gray-300",children:"Mark as Delivered"})]})}),(0,c.jsx)("tbody",{children:t.map((e=>(0,c.jsxs)("tr",{className:"hover:bg-purple-50 transition duration-200",children:[(0,c.jsx)("td",{className:"px-6 py-4 border-b border-gray-300",children:e.name}),(0,c.jsx)("td",{className:"px-6 py-4 border-b border-gray-300",children:(0,c.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold text-white rounded-md "+("approved"===e.approvedForSale?"bg-[--purple]":"pending"===e.approvedForSale?"bg-[--gold]":"denied"===e.approvedForSale?"bg-red-500":"sold"===e.approvedForSale?"bg-gray-500":"bg-gray-300"),children:e.approvedForSale.charAt(0).toUpperCase()+e.approvedForSale.slice(1)})}),(0,c.jsx)("td",{className:"px-6 py-4 border-b border-gray-300",children:(0,c.jsx)("img",{src:e.images[0].image,alt:e.name,className:"w-16 h-16 object-cover rounded-md shadow-sm"})}),(0,c.jsx)("td",{className:"px-6 py-4 border-b border-gray-300",children:(0,c.jsx)("a",{href:`/edit-product/${e._id}`,className:"text-[--gold] font-bold hover:underline "+(y[e._id]?"opacity-50 cursor-not-allowed":""),onClick:r=>{y[e._id]&&r.preventDefault()},children:"Edit"})}),(0,c.jsxs)("td",{className:"px-6 py-4 border-b border-gray-300",children:[y[e._id]&&(0,c.jsx)(i.$,{variant:"bigpurple",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to mark this item as delivered? If the item is not delivered to the buyer's delivery location that you were sent by email, you could lose your seller status."))try{const r=await d().getAccessToken(),t=(await s.A.get(`http://localhost:3001/api/order-by-product/${e}`,{headers:{Authorization:`Bearer ${r}`}})).data;if(console.log(t),!t)return void console.error("Order not found for product ID:",e);const a=await s.A.put(`http://localhost:3001/api/deliverorder/${t._id}`,{},{headers:{Authorization:`Bearer ${r}`}});n((r=>r.map((r=>r._id===e?{...r,approvedForSale:"delivered"}:r)))),200===a.status&&console.log("Order marked as delivered:",t._id),window.location.reload()}catch(x){b(x.response?x.response.data:"Error marking product as delivered"),console.error("Error handling delivery:",x)}})(e._id),children:"Mark as Delivered"}),"delivered"===e.approvedForSale&&(0,c.jsx)("span",{className:"text-green-500",children:"Delivered"})]})]},e._id)))})]})})]})]})}}}]);
//# sourceMappingURL=281.183d77f7.chunk.js.map